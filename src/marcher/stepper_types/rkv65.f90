module class_ode_stepper_rkv65

   use constants_module
   use class_ode_stepper_explicit

   private

   type, public, extends(ode_stepper_explicit) :: ode_stepper_rkv65

   contains

      procedure :: init

   end type ode_stepper_rkv65

contains

   subroutine init( s )
      class(ode_stepper_rkv65), intent(inout) :: s

      ! constant parameters
      s % can_use_dydt_in = .true.
      s % gives_exact_dydt_out = .true.
      s % gives_estimated_yerr = .true.
      s % method_order = 6
      s % name = "rkv65"
      s % stages = 8
      s % status = FPDE_STATUS_OK

      call s%ode_stepper_explicit%init()

      s % c = [ 0., 1./6., 4./15., 2./3., 5./6., 1., 1./15., 1. ]

      s % a(1,:) = [ 0.,0.,0.,0.,0.,0.,0.,0. ]
      s % a(2,:) = [ 1./6.,0.,0.,0.,0.,0.,0.,0. ]
      s % a(3,:) = [ 4./75.,16./75.,0.,0.,0.,0.,0.,0. ]
      s % a(4,:) = [ 5./6.,-(8./3.),5./2.,0.,0.,0.,0.,0. ]
      s % a(5,:) = [ -(165./64.),55./6.,-(425./64.),85./96.,0.,0.,0.,0. ]
      s % a(6,:) = [ 12./5.,-8.,4015./612.,-(11./36.),88./255.,0.,0.,0. ]
      s % a(7,:) = [ -(8263./15000.),124./75.,-(643./680.),-(81./250.),2484./10625.,0.,0.,0. ]
      s % a(8,:) = [ 3501./1720., -300./43., 297275./52632., -319./2322., 24068./84065., 0., 3850./26703., 0. ]


      s % b = [  3./40., 0., 875./2244., 23./72., 264./1955., 0., 125./11592., 43./616. ]

      s % ec = [ 1./160., 0., 125./17952., -(1./144.), 12./1955., 3./44., -(125./11592.), -(43./616.) ]

      ! s % a(8,8) = [ &
      !      [ 0.,0.,0.,0.,0.,0.,0.,0. ], &
      !      [ 1./6.,0.,0.,0.,0.,0.,0.,0. ], &
      !      [ 4./75.,16./75.,0.,0.,0.,0.,0.,0. ], &
      !      [ 5./6.,-(8./3.),5./2.,0.,0.,0.,0.,0. ], &
      !      [ -(165./64.),55./6.,-(425./64.),85./96.,0.,0.,0.,0. ], &
      !      [ 12./5.,-8.,4015./612.,-(11./36.),88./255.,0.,0.,0. ], &
      !      [ -(8263./15000.),124./75.,-(643./680.),-(81./250.),2484./10625.,0.,0.,0. ], &
      !      [ 3501./1720., -300./43., 297275./52632., -319./2322., 24068./84065., 0., 3850./26703., 0. ] &
      !      ]

   end subroutine init

end module class_ode_stepper_rkv65
